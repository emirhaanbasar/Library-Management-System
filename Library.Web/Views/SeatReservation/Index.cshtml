@model IEnumerable<Library.Web.Models.SeatReservationViewModel>
@{
    ViewData["Title"] = "Oturma Planı";
    var seats = Model.ToList();
    int seatIndex = 0;
    int tableCount = 5;
    int seatsPerTable = 6;
}
<h2 class="mb-4 text-center">Kütüphane Oturma Planı</h2>
<div class="d-flex flex-wrap justify-content-center gap-5 align-items-start" style="min-height: 500px;">
    @for (int t = 0; t < tableCount; t++)
    {
        <div class="table-area">
            <div class="d-flex flex-row align-items-center justify-content-center">
                <!-- Sol 3 koltuk -->
                <div class="d-flex flex-column gap-3">
                    @for (int i = 0; i < 3; i++)
                    {
                        if (seatIndex < seats.Count)
                        {
                            var seat = seats[seatIndex++];
                            <div class="seat-box @(seat.IsOccupied ? "occupied" : "free")">
                                <div class="seat-number">@seat.SeatNumber</div>
                                @if (seat.IsOccupied)
                                {
                                    <span class="badge bg-light text-dark">Dolu</span>
                                }
                                else
                                {
                                    <a asp-action="Reserve" asp-route-id="@seat.SeatId" class="btn btn-light btn-sm mt-1">Rezerve Et</a>
                                }
                            </div>
                        }
                    }
                </div>
                <!-- Masa -->
                <div class="table-box mx-4 d-flex align-items-center justify-content-center">
                    <span class="table-label">Masa @(t+1)</span>
                </div>
                <!-- Sağ 3 koltuk -->
                <div class="d-flex flex-column gap-3">
                    @for (int i = 0; i < 3; i++)
                    {
                        if (seatIndex < seats.Count)
                        {
                            var seat = seats[seatIndex++];
                            <div class="seat-box @(seat.IsOccupied ? "occupied" : "free")">
                                <div class="seat-number">@seat.SeatNumber</div>
                                @if (seat.IsOccupied)
                                {
                                    <span class="badge bg-light text-dark">Dolu</span>
                                }
                                else
                                {
                                    <a asp-action="Reserve" asp-route-id="@seat.SeatId" class="btn btn-light btn-sm mt-1">Rezerve Et</a>
                                }
                            </div>
                        }
                    }
                </div>
            </div>
        </div>
    }
</div>
<a asp-action="MyReservations" class="btn btn-primary mt-4">Rezervasyonlarım</a>

<style>
.table-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 30px;
}
.table-box {
    width: 120px;
    height: 180px;
    background: #424242;
    border-radius: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 2.2rem;
    margin: 0 18px;
    box-shadow: 0 4px 16px #aaa;
    color: #fff;
    border: 4px solid #1976d2;
    transition: box-shadow 0.2s;
}
.table-box:hover {
    box-shadow: 0 8px 32px #1976d2;
}
.table-label {
    font-size: 2.2rem;
    font-weight: bold;
    letter-spacing: 1px;
    color: #fff;
    text-shadow: 1px 1px 6px #000;
}
.seat-box {
    width: 80px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    margin: 6px 0;
    box-shadow: 0 2px 8px #ccc;
    border: 3px solid #888;
    transition: transform 0.1s;
}
.seat-box.free {
    background: #43a047;
    color: #fff;
    border-color: #388e3c;
}
.seat-box.occupied {
    background: #e53935;
    color: #fff;
    border-color: #b71c1c;
}
.seat-box:hover {
    transform: scale(1.07);
    z-index: 2;
}
.seat-number {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 2px;
}
</style>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/seathub")
            .build();
        connection.on("SeatChanged", function () {
            location.reload();
        });
        connection.start();
    </script>
} 